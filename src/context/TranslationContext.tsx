"use client"
import React, { createContext, useContext, useState, useEffect, useCallback } from "react"
import { translationService, type Language } from "../services/translationService"

interface TranslationContextType {
  language: Language
  setLanguage: (lang: Language) => void
  t: (key: string) => string
  translateContent: (content: string) => Promise<string>
  translateParagraphs: (paragraphs: string[]) => Promise<string[]>
}

const translations = {
  en: {
    // NovelRead page
    "chapter": "Chapter",
    "written_by": "Written by",
    "page": "Page",
    "no_content": "No content on this page",
    "loading_novel": "Loading novel...",
    "novel_not_found": "Novel not found",
    "back_to_novel": "Back to Novel Overview",
    "like_chapter": "Like this chapter",
    "login_to_like": "Login to like",
    "view_comments": "View comments",
    "login_to_comment": "Login to comment",
    "comments": "Comments",
    "no_comments": "No comments yet. Be the first to comment!",
    "write_comment": "Write a comment...",
    "post": "Post",
    "reply": "Reply",
    "cancel": "Cancel",
    "delete": "Delete",
    "just_now": "Just now",
    "ago": "ago",
    "h": "h",
    "d": "d",
    "author": "Author",
    "content_warning": "Content Warning",
    "graphic_content_warning": "This novel contains graphic or gory content that may not be suitable for all readers. Please proceed with caution.",
    "continue": "Continue",
    "go_back": "Go Back",
    "back_to_home": "← Back to Home",
    "settings": "Settings",
    "change_email": "Change Email",
    "current_email": "Current Email",
    "new_email": "New Email",
    "confirm_new_email": "Confirm New Email",
    "current_password": "Current Password",
    "send_verification_email": "Send Verification Email",
    "sending": "Sending...",
    "verification_email_sent": "Verification email sent! Check your new email and click the verification link to complete the change.",
    "change_password": "Change Password",
    "new_password": "New Password",
    "confirm_new_password": "Confirm New Password",
    "update_password": "Update Password",
    "updating": "Updating...",
    "password_updated": "Password updated",
    "delete_account": "Delete Account",
    "confirm_password": "Confirm Password",
    "delete_account_confirm": "This will permanently delete your account and data. Continue?",
    "deleting": "Deleting...",
    "account_deleted": "Account deleted",
    "google_signin_note": "Using Google sign-in. You may be asked to reauthenticate via Google popup.",
    "password_required": "Password is required to change email",
    "enter_current_password": "Enter your current password",
    "enter_new_email": "Enter new email address",
    "confirm_new_email_placeholder": "Confirm new email address",
    "enter_new_password": "Enter new password",
    "confirm_new_password_placeholder": "Confirm new password",
    "required_to_delete": "Required to delete your account",
    "go_to_login": "Go to Login",
    "please_login": "Please log in to manage your settings",
    "send_test_verification": "Send Test Verification",
    "test_verification_sent": "Test verification email sent. Check your inbox (and spam).",
  },
  fr: {
    "chapter": "Chapitre",
    "written_by": "Écrit par",
    "page": "Page",
    "no_content": "Aucun contenu sur cette page",
    "loading_novel": "Chargement du roman...",
    "novel_not_found": "Roman introuvable",
    "back_to_novel": "Retour à l'aperçu du roman",
    "like_chapter": "Aimer ce chapitre",
    "login_to_like": "Connectez-vous pour aimer",
    "view_comments": "Voir les commentaires",
    "login_to_comment": "Connectez-vous pour commenter",
    "comments": "Commentaires",
    "no_comments": "Aucun commentaire pour le moment. Soyez le premier à commenter !",
    "write_comment": "Écrire un commentaire...",
    "post": "Publier",
    "reply": "Répondre",
    "cancel": "Annuler",
    "delete": "Supprimer",
    "just_now": "À l'instant",
    "ago": "il y a",
    "h": "h",
    "d": "j",
    "author": "Auteur",
    "content_warning": "Avertissement de contenu",
    "graphic_content_warning": "Ce roman contient du contenu graphique ou sanglant qui pourrait ne pas convenir à tous les lecteurs. Veuillez procéder avec prudence.",
    "continue": "Continuer",
    "go_back": "Retour",
    "back_to_home": "← Retour à l'accueil",
    "settings": "Paramètres",
    "change_email": "Changer l'email",
    "current_email": "Email actuel",
    "new_email": "Nouvel email",
    "confirm_new_email": "Confirmer le nouvel email",
    "current_password": "Mot de passe actuel",
    "send_verification_email": "Envoyer l'email de vérification",
    "sending": "Envoi...",
    "verification_email_sent": "Email de vérification envoyé ! Vérifiez votre nouvel email et cliquez sur le lien de vérification pour terminer le changement.",
    "change_password": "Changer le mot de passe",
    "new_password": "Nouveau mot de passe",
    "confirm_new_password": "Confirmer le nouveau mot de passe",
    "update_password": "Mettre à jour le mot de passe",
    "updating": "Mise à jour...",
    "password_updated": "Mot de passe mis à jour",
    "delete_account": "Supprimer le compte",
    "confirm_password": "Confirmer le mot de passe",
    "delete_account_confirm": "Cela supprimera définitivement votre compte et vos données. Continuer ?",
    "deleting": "Suppression...",
    "account_deleted": "Compte supprimé",
    "google_signin_note": "Utilisation de la connexion Google. Vous pourriez être invité à vous réauthentifier via la popup Google.",
    "password_required": "Le mot de passe est requis pour changer l'email",
    "enter_current_password": "Entrez votre mot de passe actuel",
    "enter_new_email": "Entrez la nouvelle adresse email",
    "confirm_new_email_placeholder": "Confirmez la nouvelle adresse email",
    "enter_new_password": "Entrez le nouveau mot de passe",
    "confirm_new_password_placeholder": "Confirmez le nouveau mot de passe",
    "required_to_delete": "Requis pour supprimer votre compte",
    "go_to_login": "Aller à la connexion",
    "please_login": "Veuillez vous connecter pour gérer vos paramètres",
    "send_test_verification": "Envoyer un test de vérification",
    "test_verification_sent": "Email de test de vérification envoyé. Vérifiez votre boîte de réception (et spam).",
  },
  es: {
    "chapter": "Capítulo",
    "written_by": "Escrito por",
    "page": "Página",
    "no_content": "No hay contenido en esta página",
    "loading_novel": "Cargando novela...",
    "novel_not_found": "Novela no encontrada",
    "back_to_novel": "Volver al resumen de la novela",
    "like_chapter": "Me gusta este capítulo",
    "login_to_like": "Inicia sesión para dar me gusta",
    "view_comments": "Ver comentarios",
    "login_to_comment": "Inicia sesión para comentar",
    "comments": "Comentarios",
    "no_comments": "Aún no hay comentarios. ¡Sé el primero en comentar!",
    "write_comment": "Escribir un comentario...",
    "post": "Publicar",
    "reply": "Responder",
    "cancel": "Cancelar",
    "delete": "Eliminar",
    "just_now": "Ahora mismo",
    "ago": "hace",
    "h": "h",
    "d": "d",
    "author": "Autor",
    "content_warning": "Advertencia de contenido",
    "graphic_content_warning": "Esta novela contiene contenido gráfico o sangriento que puede no ser adecuado para todos los lectores. Proceda con precaución.",
    "continue": "Continuar",
    "go_back": "Volver",
    "back_to_home": "← Volver al inicio",
    "settings": "Configuración",
    "change_email": "Cambiar email",
    "current_email": "Email actual",
    "new_email": "Nuevo email",
    "confirm_new_email": "Confirmar nuevo email",
    "current_password": "Contraseña actual",
    "send_verification_email": "Enviar email de verificación",
    "sending": "Enviando...",
    "verification_email_sent": "¡Email de verificación enviado! Revisa tu nuevo email y haz clic en el enlace de verificación para completar el cambio.",
    "change_password": "Cambiar contraseña",
    "new_password": "Nueva contraseña",
    "confirm_new_password": "Confirmar nueva contraseña",
    "update_password": "Actualizar contraseña",
    "updating": "Actualizando...",
    "password_updated": "Contraseña actualizada",
    "delete_account": "Eliminar cuenta",
    "confirm_password": "Confirmar contraseña",
    "delete_account_confirm": "Esto eliminará permanentemente tu cuenta y datos. ¿Continuar?",
    "deleting": "Eliminando...",
    "account_deleted": "Cuenta eliminada",
    "google_signin_note": "Usando inicio de sesión con Google. Es posible que se te pida reautenticarte a través de la ventana emergente de Google.",
    "password_required": "Se requiere contraseña para cambiar el email",
    "enter_current_password": "Ingresa tu contraseña actual",
    "enter_new_email": "Ingresa la nueva dirección de email",
    "confirm_new_email_placeholder": "Confirma la nueva dirección de email",
    "enter_new_password": "Ingresa la nueva contraseña",
    "confirm_new_password_placeholder": "Confirma la nueva contraseña",
    "required_to_delete": "Requerido para eliminar tu cuenta",
    "go_to_login": "Ir al inicio de sesión",
    "please_login": "Por favor inicia sesión para gestionar tu configuración",
    "send_test_verification": "Enviar verificación de prueba",
    "test_verification_sent": "Email de verificación de prueba enviado. Revisa tu bandeja de entrada (y spam).",
  },
  pt: {
    "chapter": "Capítulo",
    "written_by": "Escrito por",
    "page": "Página",
    "no_content": "Nenhum conteúdo nesta página",
    "loading_novel": "Carregando romance...",
    "novel_not_found": "Romance não encontrado",
    "back_to_novel": "Voltar ao resumo do romance",
    "like_chapter": "Curtir este capítulo",
    "login_to_like": "Faça login para curtir",
    "view_comments": "Ver comentários",
    "login_to_comment": "Faça login para comentar",
    "comments": "Comentários",
    "no_comments": "Ainda não há comentários. Seja o primeiro a comentar!",
    "write_comment": "Escrever um comentário...",
    "post": "Publicar",
    "reply": "Responder",
    "cancel": "Cancelar",
    "delete": "Excluir",
    "just_now": "Agora mesmo",
    "ago": "atrás",
    "h": "h",
    "d": "d",
    "author": "Autor",
    "content_warning": "Aviso de conteúdo",
    "graphic_content_warning": "Este romance contém conteúdo gráfico ou sangrento que pode não ser adequado para todos os leitores. Proceda com cautela.",
    "continue": "Continuar",
    "go_back": "Voltar",
    "back_to_home": "← Voltar ao início",
    "settings": "Configurações",
    "change_email": "Alterar email",
    "current_email": "Email atual",
    "new_email": "Novo email",
    "confirm_new_email": "Confirmar novo email",
    "current_password": "Senha atual",
    "send_verification_email": "Enviar email de verificação",
    "sending": "Enviando...",
    "verification_email_sent": "Email de verificação enviado! Verifique seu novo email e clique no link de verificação para completar a alteração.",
    "change_password": "Alterar senha",
    "new_password": "Nova senha",
    "confirm_new_password": "Confirmar nova senha",
    "update_password": "Atualizar senha",
    "updating": "Atualizando...",
    "password_updated": "Senha atualizada",
    "delete_account": "Excluir conta",
    "confirm_password": "Confirmar senha",
    "delete_account_confirm": "Isso excluirá permanentemente sua conta e dados. Continuar?",
    "deleting": "Excluindo...",
    "account_deleted": "Conta excluída",
    "google_signin_note": "Usando login do Google. Você pode ser solicitado a se reautenticar via popup do Google.",
    "password_required": "Senha é necessária para alterar o email",
    "enter_current_password": "Digite sua senha atual",
    "enter_new_email": "Digite o novo endereço de email",
    "confirm_new_email_placeholder": "Confirme o novo endereço de email",
    "enter_new_password": "Digite a nova senha",
    "confirm_new_password_placeholder": "Confirme a nova senha",
    "required_to_delete": "Necessário para excluir sua conta",
    "go_to_login": "Ir para o login",
    "please_login": "Por favor, faça login para gerenciar suas configurações",
    "send_test_verification": "Enviar verificação de teste",
    "test_verification_sent": "Email de verificação de teste enviado. Verifique sua caixa de entrada (e spam).",
  },
}

const TranslationContext = createContext<TranslationContextType>({} as TranslationContextType)

export const useTranslation = () => {
  return useContext(TranslationContext)
}

export const TranslationProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [language, setLanguage] = useState<Language>("en")

  useEffect(() => {
    // Load saved language from localStorage
    const savedLanguage = localStorage.getItem("novel-app-language") as Language
    if (savedLanguage && ["en", "fr", "es", "pt"].includes(savedLanguage)) {
      setLanguage(savedLanguage)
    }
  }, [])

  const handleSetLanguage = (lang: Language) => {
    setLanguage(lang)
    localStorage.setItem("novel-app-language", lang)
  }

  const t = (key: string): string => {
    return translations[language][key as keyof typeof translations[typeof language]] || key
  }

  const translateContent = useCallback(async (content: string): Promise<string> => {
    return await translationService.translateWithCache(content, language)
  }, [language])

  const translateParagraphs = useCallback(async (paragraphs: string[]): Promise<string[]> => {
    return await translationService.translateParagraphs(paragraphs, language)
  }, [language])

  const value = {
    language,
    setLanguage: handleSetLanguage,
    t,
    translateContent,
    translateParagraphs,
  }

  return <TranslationContext.Provider value={value}>{children}</TranslationContext.Provider>
}
